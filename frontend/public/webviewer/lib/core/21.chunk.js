/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{596:function(ya,ua,n){n.r(ua);var pa=n(0),oa=n(7),na=n(3);ya=n(55);var ka=n(34),ia=n(17);n=function(){function fa(){this.init()}fa.prototype.init=function(){this.Lpa=!1;this.Qg=this.kp=this.connection=null;this.xl={};this.ga=this.IO=null};fa.prototype.BO=function(x){for(var y=this,w=0;w<x.length;++w){var b=x[w];switch(b.at){case "create":this.xl[b.author]||(this.xl[b.author]=b.aName);this.iAa(b);break;case "modify":this.ga.Bs(b.xfdf).then(function(f){y.ga.Db(f[0])});
break;case "delete":b="<delete><id>".concat(b.aId,"</id></delete>"),this.ga.Bs(b)}}};fa.prototype.iAa=function(x){var y=this;this.ga.Bs(x.xfdf).then(function(w){w=w[0];w.authorId=x.author;y.ga.Db(w);y.ga.trigger(oa.d.UPDATE_ANNOTATION_PERMISSION,[w])})};fa.prototype.mza=function(x,y,w){this.kp&&this.kp(x,y,w)};fa.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.mza.bind(this,x,"add",{imported:!1}),{once:!0})};fa.prototype.initiateCollaboration=
function(x,y,w){var b=this;if(x){b.Qg=y;b.ga=w.ia();w.addEventListener(oa.i.DOCUMENT_UNLOADED,function(){b.disableCollaboration()});b.dOa(x);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var h=JSON.parse(f.responseText);b.connection=exports.da.wPa(Object(ka.k)(b.Qg,"blackbox/"),"annot");b.IO=h.id;b.xl[h.id]=h.user_name;b.ga.NY(h.id);b.connection.cTa(function(e){e.t&&e.t.startsWith("a_")&&e.data&&b.BO(e.data)},function(){b.connection.send({t:"a_retrieve",
dId:x});b.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[b.xl[h.id],b.IO])},function(){b.disableCollaboration()})}catch(e){Object(na.f)(e.message)}});f.open("GET",Object(ka.k)(this.Qg,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();b.Lpa=!0;b.ga.bea(function(h){return b.xl[h.Author]||h.Author})}else Object(na.f)("Document ID required for collaboration")};fa.prototype.disableCollaboration=function(){this.kp&&(this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.kp),this.kp=
null);this.connection&&this.connection.Ju();this.ga&&this.ga.NY("Guest");this.init();this.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};fa.prototype.dOa=function(x){var y=this;this.kp&&this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.kp);this.kp=function(w,b,f){return Object(pa.b)(this,void 0,void 0,function(){var h,e,a,r,z,aa,ea,ba,ha;return Object(pa.d)(this,function(ca){switch(ca.label){case 0:if(f.imported)return[2];h={t:"a_".concat(b),dId:x,annots:[]};return[4,y.ga.z6()];
case 1:e=ca.aa();"delete"!==b&&(a=(new DOMParser).parseFromString(e,"text/xml"),r=new XMLSerializer);for(z=0;z<w.length;z++)aa=w[z],ba=ea=void 0,"add"===b?(ea=a.querySelector('[name="'.concat(aa.Id,'"]')),ba=r.serializeToString(ea),ha=null,aa.InReplyTo&&(ha=y.ga.Ci(aa.InReplyTo).authorId||"default"),h.annots.push({at:"create",aId:aa.Id,author:y.IO,aName:y.xl[y.IO],parent:ha,xfdf:"<add>".concat(ba,"</add>")})):"modify"===b?(ea=a.querySelector('[name="'.concat(aa.Id,'"]')),ba=r.serializeToString(ea),
h.annots.push({at:"modify",aId:aa.Id,xfdf:"<modify>".concat(ba,"</modify>")})):"delete"===b&&h.annots.push({at:"delete",aId:aa.Id});0<h.annots.length&&y.connection.send(h);return[2]}})})}.bind(y);this.ga.addEventListener(ia.a.Events.ANNOTATION_CHANGED,this.kp)};fa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return fa}();Object(ya.a)(n);ua["default"]=n}}]);}).call(this || window)
